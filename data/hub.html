<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PACx Demo Hub</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="hdot"></div>
      <h1>PACx Demo’s</h1>
    </div>

    <div class="toolbar">
      <button id="refresh" class="btn ghost">Refresh</button>
      <a class="btn ghost" href="./admin.html">Admin</a>
      <small id="last-updated" class="small"></small>
    </div>

    <div id="grid" class="grid"></div>

    <footer style="margin-top:18px">
      <p class="note">Tiles are read from <code>/data/canvases.json</code>. If a link is invalid, open Admin to update.</p>
    </footer>
  </div>

  <script>
  const grid = document.getElementById('grid');
  const last = document.getElementById('last-updated');

  function isValidUrl(s){ try{ new URL(s); return true; } catch { return false; } }

  function tileEl(t){
    const a = document.createElement('a');
    a.className = 'tile-link'; a.target = '_blank'; a.rel = 'noopener noreferrer';
    if(isValidUrl(t.url)){ a.href = t.url; a.ariaLabel = `Open ${t.title}`; a.textContent = 'Open'; }
    else { a.href = '#'; a.textContent = 'Fix URL'; }
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `<h3>${t.title}</h3><p class="small">${t.description||''}</p>`;
    card.appendChild(a);
    return card;
  }

  async function load(){
    grid.textContent = 'Loading…';
    try{
      const res = await fetch('./data/canvases.json?cache=' + Date.now());
      const json = await res.json();
      grid.textContent = '';
      json.tiles.forEach(t => grid.appendChild(tileEl(t)));
      last.textContent = 'Updated ' + (json.updatedAt || '');
    }catch(e){
      grid.textContent = 'Failed to load tiles.';
      console.error(e);
    }
  }

  document.getElementById('refresh').onclick = load;
  load();
  </script>
</body>
</html>
