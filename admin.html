<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PACx • Admin</title>
  <meta name="description" content="Manage PACx Canvas tiles. Drag to reorder, save to persist."/>
  <style>
    :root{
      --bg:#0f1223; --panel:#161a2e; --text:#eaf0ff; --sub:#a8b1d1;
      --mint:#56f3a6; --accent:#37b9f1; --btn:#3be281; --btnText:#02100a; --border:#2a2f4a;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    .top{display:flex;gap:12px;justify-content:flex-end;align-items:center;padding:14px 18px}
    .chip{background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:12px;padding:10px 14px;text-decoration:none;font-weight:700}
    .cta{background:var(--btn);color:var(--btnText)}
    .wrap{max-width:960px;margin:0 auto;padding:28px 20px 64px}
    .h1{font-size:28px;color:var(--mint);font-weight:900;margin:0 0 6px}
    .sub{color:var(--sub);margin-bottom:12px}
    .tile{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;margin:14px 0}
    label{display:block;margin:10px 0 6px;color:var(--sub)}
    input,textarea{width:100%;background:#0b0e1b;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:12px}
    .btn{background:var(--btn);color:var(--btnText);font-weight:800;padding:10px 14px;border-radius:12px;border:none;cursor:pointer}
    .ghost{background:transparent;color:var(--text);border:1px solid var(--border)}
    .drag{background:transparent;border:1px dashed var(--border);color:var(--sub);padding:6px 10px;border-radius:10px;cursor:grab}
    .danger{background:#ff5c5c;color:#02100a}
  </style>
</head>
<body>
  <div class="top">
    <a class="chip" href="index.html">← Back to Hub</a>
    <a class="chip" href="canvas-demo.html">Open Canvas Hub</a>
    <a class="chip cta" href="https://chat.openai.com" target="_blank" rel="noopener">Co-Create with PACx</a>
  </div>

  <div class="wrap">
    <div class="h1">Canvas Tiles</div>
    <div class="sub">Add, rename, update links, and <strong>drag to reorder</strong>. Click <em>Save Tiles</em> then refresh the Canvas Hub.</div>

    <div id="tiles"></div>

    <div class="row">
      <button class="btn" id="add">+ Add Tile</button>
      <button class="btn" id="save">Save Tiles</button>
      <button class="btn ghost" id="reset">Reset to Defaults</button>
    </div>
  </div>

  <script>
    const KEY = 'pacx_canvas_tiles';

    function defaults(){
      return [
        {title:'Ideal Client WOW! Segmentation', url:'', desc:'Shared canvas link ending …'},
        {title:'PACx Minimal Game Flow — MVP', url:'', desc:'Shared canvas link ending …'},
        {title:'PACx Mobile — Tap To Run (v2)', url:'', desc:'Shared canvas link ending …'},
        {title:'PACx Onboarding Blueprint v1.0', url:'', desc:'The blue print of flow for PACx'},
      ];
    }

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw){ return defaults(); }
        const arr = JSON.parse(raw);
        return Array.isArray(arr) ? arr : defaults();
      }catch(e){ return defaults(); }
    }

    function save(list){
      localStorage.setItem(KEY, JSON.stringify(list));
    }

    let model = load();

    const host = document.getElementById('tiles');

    function tileNode(item, idx){
      const wrap = document.createElement('div');
      wrap.className = 'tile';
      wrap.setAttribute('draggable','true');
      wrap.dataset.index = idx;

      wrap.innerHTML = `
        <button class="drag" type="button">↕ Drag</button>
        <label>Title</label>
        <input type="text" value="${item.title || ''}" data-k="title"/>
        <label>Canvas URL</label>
        <input type="url" placeholder="https://chatgpt.com/canvas/shared/…" value="${item.url || ''}" data-k="url"/>
        <label>Description (optional)</label>
        <input type="text" value="${item.desc || ''}" data-k="desc"/>
        <div class="row">
          <button class="btn danger" type="button" data-act="remove">Remove</button>
        </div>
      `;

      // editing
      wrap.querySelectorAll('input').forEach(inp=>{
        inp.addEventListener('input', e=>{
          const k = inp.dataset.k;
          model[idx][k] = inp.value;
        });
      });

      // remove
      wrap.querySelector('[data-act="remove"]').addEventListener('click', ()=>{
        model.splice(idx,1);
        render();
      });

      // drag events
      wrap.addEventListener('dragstart', e=>{
        e.dataTransfer.setData('text/plain', String(idx));
        wrap.style.opacity = '0.6';
      });
      wrap.addEventListener('dragend', ()=>{ wrap.style.opacity = '1'; });

      wrap.addEventListener('dragover', e=>{ e.preventDefault(); wrap.style.outline = '1px dashed var(--mint)'; });
      wrap.addEventListener('dragleave', ()=>{ wrap.style.outline = 'none'; });

      wrap.addEventListener('drop', e=>{
        e.preventDefault();
        wrap.style.outline = 'none';
        const from = Number(e.dataTransfer.getData('text/plain'));
        const to = Number(wrap.dataset.index);
        if(isNaN(from) || isNaN(to) || from===to) return;
        const moved = model.splice(from,1)[0];
        model.splice(to,0,moved);
        render();
      });

      return wrap;
    }

    function render(){
      host.innerHTML = '';
      model.forEach((item, idx)=>{
        host.appendChild(tileNode(item, idx));
      });
    }

    // buttons
    document.getElementById('add').addEventListener('click', ()=>{
      model.push({title:'Canvas', url:'', desc:''});
      render();
    });

    document.getElementById('save').addEventListener('click', ()=>{
      save(model);
      alert('Saved. Open/refresh the Canvas Demo Hub to see your tiles.');
    });

    document.getElementById('reset').addEventListener('click', ()=>{
      if(confirm('Reset the tiles to defaults?')){
        model = defaults();
        save(model);
        render();
      }
    });

    render();
  </script>
</body>
</html>
