<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PACx Staging Hub</title>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel so JSX works in-browser for staging -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <!-- App -->
  <script type="text/babel" data-presets="react,env">
    const { useState, useMemo, useEffect } = React;

    /*********************** Home Tiles ************************/
    const MVP_LINKS = [
      { id: "launch",  title: "PACx MVP Launch",          desc: "One hub · go live plan",                 anchor: "#demo-launch" },
      { id: "mobile",  title: "PACx Mobile",              desc: "Tap to Run · quick demo",                anchor: "#demo-mobile" },
      { id: "minflow", title: "PACx · Minimal Game Flow", desc: "Fast path: AAA → LLL",                   anchor: "#demo-minflow" },
      { id: "lll",     title: "Lag/Lead/Lift Tracker",    desc: "Goals · weekly leads · lift habits",     anchor: "#demo-lll" },
      { id: "wow",     title: "Ideal Client WOW",         desc: "Segmentation · deposits by type",        anchor: "#demo-wow" },
      { id: "sow",     title: "SOW Helper",               desc: "Statement of Work builder",              anchor: "#demo-sow" },
      { id: "lib",     title: "Resource Library",         desc: "Docs · Playbooks · Videos",              anchor: "#demo-lib" },
      { id: "game",    title: "Gamification",             desc: "Coins · Streaks · Badges",               anchor: "#demo-game" },
      { id: "modes",   title: "PACx Direct & Teams",      desc: "Single + Multiplayer",                   anchor: "#demo-modes" },
      { id: "vmap",    title: "V-MAP",                    desc: "Living one-page business plan",          anchor: "#demo-vmap" },
      { id: "aaa",     title: "AAA Flow",                 desc: "Awareness → Action → Achievement",       anchor: "#demo-aaa" },
    ];

    const DEFAULT_TEAMS = ["Development", "Marketing", "Operations", "Financial"];

    const DEFAULT_PLAYERS = [
      { id: "p1", name: "Alan Graham", team: "Development", avatar: "🕺", lag: 88, lead: 92, lift: 96, dials: 3, notes: [] },
      { id: "p2", name: "Reggie Lawrence", team: "Marketing", avatar: "🕺", lag: 90, lead: 90, lift: 95, dials: 2, notes: [] },
      { id: "p3", name: "Rich Campe", team: "Operations", avatar: "🧔", lag: 91, lead: 93, lift: 98, dials: 3, notes: [] },
      { id: "p4", name: "Jon Zieve", team: "Financial", avatar: "🧔🏻", lag: 85, lead: 88, lift: 92, dials: 2, notes: [] },
      { id: "p5", name: "Drake Lewis", team: "Marketing", avatar: "🧍", lag: 70, lead: 74, lift: 80, dials: 4, notes: [] },
      { id: "p6", name: "Dave Erland", team: "Operations", avatar: "🧑‍🦲", lag: 56, lead: 60, lift: 52, dials: 1, notes: [] },
      { id: "p7", name: "Nick Davies", team: "Development", avatar: "👨‍🦳", lag: 49, lead: 55, lift: 45, dials: 4, notes: [] },
      { id: "p8", name: "Joshua Greco", team: "Financial", avatar: "🧔🏼", lag: 18, lead: 22, lift: 20, dials: 5, notes: [] },
    ];

    /*********************** Helpers ************************/
    const STORAGE_KEY = "pacx_staging_hub_inline";
    const clampPct = (n) => Math.max(0, Math.min(100, Math.round(n)));
    const scoreFor = (p, metric) => {
      if (metric === "Lag") return p.lag;
      if (metric === "Lead") return p.lead;
      if (metric === "Lift") return p.lift;
      return Math.round((p.lag + p.lead + p.lift) / 3);
    };

    const Badge = ({ children }) => (
      <span className="inline-flex items-center rounded-full border px-2 py-1 text-xs font-medium">
        {children}
      </span>
    );

    const ProgressBar = ({ value }) => {
      const clamped = clampPct(value);
      return (
        <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
          <div className="h-2 bg-black transition-all" style={{ width: `${clamped}%` }} />
        </div>
      );
    };

    /*********************** Main Component ************************/
    function PacxStagingHub() {
      const [players, setPlayers] = useState(() => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return DEFAULT_PLAYERS;
          const parsed = JSON.parse(raw);
          return parsed.players ?? DEFAULT_PLAYERS;
        } catch {
          return DEFAULT_PLAYERS;
        }
      });
      const [teams, setTeams] = useState(() => {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return DEFAULT_TEAMS;
          const parsed = JSON.parse(raw);
          return parsed.teams ?? DEFAULT_TEAMS;
        } catch {
          return DEFAULT_TEAMS;
        }
      });
      const [metric, setMetric] = useState("All");
      const [teamFilter, setTeamFilter] = useState("All");
      const [saved, setSaved] = useState([]);
      const [newViewName, setNewViewName] = useState("");
      const [showPlayerId, setShowPlayerId] = useState(null);
      const [huddleAgenda, setHuddleAgenda] = useState("");
      const [vmap, setVmap] = useState({ vision: "", mission: "", values: "", lag: "", strategies: "", projects: "", leads: "" });

      useEffect(() => {
        const payload = { players, teams, vmap };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      }, [players, teams, vmap]);

      const filteredPlayers = useMemo(() => {
        return players
          .filter((p) => (teamFilter === "All" ? true : p.team === teamFilter))
          .sort((a, b) => scoreFor(b, metric) - scoreFor(a, metric));
      }, [players, teamFilter, metric]);

      const totalDials = useMemo(() => filteredPlayers.reduce((acc, p) => acc + (p.dials || 0), 0), [filteredPlayers]);

      const addPlayer = (name, team, avatar) => {
        if (!name || !team) return;
        const id = `p${players.length + 1}`;
        setPlayers([...players, { id, name, team, avatar: avatar || "👤", lag: 50, lead: 50, lift: 50, dials: 0, notes: [] }]);
      };
      const addTeam = (team) => {
        if (!team || teams.includes(team)) return;
        setTeams([...teams, team]);
      };
      const saveView = () => {
        const id = `v${Date.now()}`;
        const view = { id, name: newViewName || `${metric} • ${teamFilter}`, metric, teams: teamFilter };
        setSaved([view, ...saved]);
        setNewViewName("");
      };
      const applyView = (v) => {
        setMetric(v.metric);
        setTeamFilter(v.teams || "All");
      };
      const playerById = (id) => players.find((p) => p.id === id);

      return (
        <div className="mx-auto max-w-6xl p-4 md:p-6">
          {/* Header */}
          <header className="sticky top-0 z-10 -mx-4 -mt-4 mb-6 bg-white/80 backdrop-blur p-4 border-b">
            <div className="flex items-center justify-between gap-4">
              <div className="flex items-center gap-3">
                <div className="rounded-2xl border px-3 py-1 text-xs uppercase tracking-wide">PAC / PACx</div>
                <h1 className="text-lg sm:text-2xl font-bold">Staging Hub · Demo MVPs</h1>
              </div>
              <div className="flex items-center gap-2 text-sm">
                <Badge>Total Dials: {totalDials}</Badge>
                <Badge>Metric: {metric}</Badge>
              </div>
            </div>
          </header>

          {/* Home Hub */}
          <section className="mb-8">
            <div className="rounded-2xl border p-5">
              <h2 className="text-xl font-semibold">Home · All Demo MVPs</h2>
              <p className="text-sm text-gray-600 mt-1">Click an area to test and leave feedback.</p>
              <div className="mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {MVP_LINKS.map((m) => (
                  <a key={m.id} href={m.anchor} className="rounded-2xl border p-4 hover:shadow-sm block">
                    <div className="flex items-center justify-between">
                      <div>
                        <p className="font-semibold">{m.title}</p>
                        <p className="text-xs text-gray-500 mt-0.5">{m.desc}</p>
                      </div>
                      <span>→</span>
                    </div>
                  </a>
                ))}
              </div>
            </div>
          </section>

          {/* Filters / Views */}
          <section className="mb-6">
            <div className="rounded-2xl border p-4">
              <div className="flex flex-wrap gap-3 items-end">
                <div>
                  <label className="text-xs text-gray-500">Metric</label>
                  <select value={metric} onChange={(e) => setMetric(e.target.value)} className="border rounded px-2 py-1 text-sm ml-2">
                    {(["All", "Lag", "Lead", "Lift"]).map((m) => <option key={m}>{m}</option>)}
                  </select>
                </div>
                <div>
                  <label className="text-xs text-gray-500">Team</label>
                  <select value={teamFilter} onChange={(e) => setTeamFilter(e.target.value)} className="border rounded px-2 py-1 text-sm ml-2">
                    <option>All</option>
                    {teams.map((t) => <option key={t}>{t}</option>)}
                  </select>
                </div>
                <div className="flex items-center gap-2">
                  <input value={newViewName} onChange={(e) => setNewViewName(e.target.value)} placeholder="Save view as…" className="border rounded px-2 py-1 text-sm" />
                  <button onClick={saveView} className="px-3 py-1 rounded-full border text-sm hover:bg-gray-50">Save View</button>
                </div>
                {saved.length ? (
                  <div className="flex items-center gap-2 flex-wrap">
                    {saved.map((v) => (
                      <button key={v.id} onClick={() => applyView(v)} className="px-3 py-1 rounded-full border text-sm hover:bg-gray-50">
                        {v.name}
                      </button>
                    ))}
                  </div>
                ) : (
                  <p className="text-xs text-gray-500">No saved views yet — set filters and click "Save View".</p>
                )}
              </div>
            </div>
          </section>

          {/* Players Stack Rank */}
          <section id="demo-lll" className="mb-8">
            <div className="flex items-center justify-between mb-3">
              <h2 className="text-xl font-semibold">Avatar Health · Stack Rank</h2>
              <Badge>{metric === "All" ? "Combined" : metric} · {teamFilter === "All" ? "All Teams" : teamFilter}</Badge>
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {filteredPlayers.map((p, idx) => {
                const score = scoreFor(p, metric);
                return (
                  <button key={p.id} onClick={() => setShowPlayerId(p.id)} className="text-left rounded-xl border p-4 flex items-center gap-4 hover:shadow-sm">
                    <div className="text-3xl" aria-hidden>{p.avatar}</div>
                    <div className="flex-1">
                      <div className="flex items-center justify-between">
                        <h3 className="font-semibold">{idx + 1}. {p.name}</h3>
                        <Badge>{p.dials ?? 0} Dials</Badge>
                      </div>
                      <p className="text-xs text-gray-500">{p.team}</p>
                      <div className="mt-2 grid grid-cols-3 gap-3 text-sm">
                        <div>
                          <div className="flex justify-between"><span>Lag</span><span>{p.lag}%</span></div>
                          <ProgressBar value={p.lag} />
                        </div>
                        <div>
                          <div className="flex justify-between"><span>Lead</span><span>{p.lead}%</span></div>
                          <ProgressBar value={p.lead} />
                        </div>
                        <div>
                          <div className="flex justify-between"><span>Lift</span><span>{p.lift}%</span></div>
                          <ProgressBar value={p.lift} />
                        </div>
                      </div>
                      <div className="mt-2 text-xs text-gray-600">Overall: {score}%</div>
                    </div>
                  </button>
                );
              })}
            </div>
          </section>

          {/* Add Player / Team */}
          <section className="mb-10">
            <div className="rounded-2xl border p-4">
              <h3 className="font-semibold">Add Player / Special Team</h3>
              <div className="mt-3 flex flex-wrap items-center gap-2">
                <input id="np-name" placeholder="Name" className="border rounded px-2 py-1 text-sm" />
                <select id="np-team" className="border rounded px-2 py-1 text-sm">
                  <option value="">Team</option>
                  {teams.map((t) => <option key={t}>{t}</option>)}
                </select>
                <input id="np-avatar" placeholder="Avatar emoji" className="border rounded px-2 py-1 text-sm w-24" />
                <button
                  onClick={() => {
                    const name = document.getElementById("np-name").value;
                    const team = document.getElementById("np-team").value;
                    const avatar = document.getElementById("np-avatar").value || "👤";
                    addPlayer(name, team, avatar);
                    document.getElementById("np-name").value = "";
                    document.getElementById("np-team").value = "";
                    document.getElementById("np-avatar").value = "";
                  }}
                  className="px-3 py-1 border rounded bg-black text-white text-sm"
                >
                  Add Player
                </button>
                <span className="mx-2 text-gray-400">/</span>
                <input id="new-team" placeholder="New team name" className="border rounded px-2 py-1 text-sm" />
                <button
                  onClick={() => {
                    const v = document.getElementById("new-team").value.trim();
                    addTeam(v);
                    document.getElementById("new-team").value = "";
                  }}
                  className="px-3 py-1 border rounded text-sm hover:bg-gray-50"
                >
                  Add Team
                </button>
              </div>
            </div>
          </section>

          {/* Coach Huddle */}
          <section id="demo-modes" className="mb-10">
            <div className="rounded-2xl border p-4">
              <h2 className="text-xl font-semibold">Coach Huddle Planner</h2>
              <p className="text-xs text-gray-500">Set agenda in advance; paste Fathom link; attribute actions later in Player details.</p>
              <textarea value={huddleAgenda} onChange={(e) => setHuddleAgenda(e.target.value)} placeholder="Agenda for next Huddle…" className="w-full border rounded p-2 text-sm mt-3" rows={4} />
            </div>
          </section>

          {/* V-MAP (One Page) */}
          <section id="demo-vmap" className="mb-14">
            <div className="rounded-2xl border p-4">
              <h2 className="text-xl font-semibold">V-MAP · Virtual Momentum Action Plan</h2>
              <p className="text-xs text-gray-500">Living, editable one-page plan tied to game metrics.</p>
              <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                {[
                  ["Vision", "vision"],
                  ["Mission", "mission"],
                  ["Values", "values"],
                  ["Lag KPIs", "lag"],
                  ["Strategies", "strategies"],
                  ["Projects", "projects"],
                  ["Lead Indicators", "leads"],
                ].map(([label, key]) => (
                  <div key={key} className="rounded-xl border p-3">
                    <div className="flex items-center justify-between">
                      <p className="font-medium">{label}</p>
                    </div>
                    <textarea
                      value={vmap[key]}
                      onChange={(e) => setVmap({ ...vmap, [key]: e.target.value })}
                      placeholder={`${label}…`}
                      className="mt-2 w-full border rounded p-2 text-sm"
                      rows={4}
                    />
                  </div>
                ))}
              </div>
            </div>
          </section>

          {/* Placeholder demo sections so tiles scroll somewhere */}
          {[
            ["demo-launch",  "PACx MVP Launch", "Master hub and go-live plan"],
            ["demo-mobile",  "PACx Mobile", "Tap-to-Run mobile demo"],
            ["demo-minflow", "Minimal Game Flow", "AAA → LLL fast path"],
            ["demo-wow",     "Ideal Client WOW", "Segmentation & WOW deposits"],
            ["demo-sow",     "SOW Helper", "Statement of Work builder"],
          ].map(([id, title, blurb]) => (
            <section id={id} key={id} className="mb-6">
              <div className="rounded-2xl border p-4">
                <h2 className="text-xl font-semibold">{title}</h2>
                <p className="text-sm text-gray-600">{blurb}</p>
                <div className="mt-3 text-sm text-gray-500">
                  Placeholder content — wire this to the live demo link or embed next.
                </div>
              </div>
            </section>
          ))}

          {/* Player Detail Modal */}
          {showPlayerId && (
            <div className="fixed inset-0 bg-black/40 z-50 flex items-center justify-center p-4" role="dialog" aria-modal>
              <div className="bg-white rounded-2xl w-full max-w-xl p-5">
                {(() => {
                  const p = playerById(showPlayerId);
                  if (!p) return null;
                  const overall = scoreFor(p, "All");
                  return (
                    <div>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <div className="text-3xl" aria-hidden>{p.avatar}</div>
                          <div>
                            <h3 className="font-semibold">{p.name}</h3>
                            <p className="text-xs text-gray-500">{p.team}</p>
                          </div>
                        </div>
                        <button onClick={() => setShowPlayerId(null)} className="rounded-full border px-3 py-1 text-sm">Close</button>
                      </div>

                      <div className="mt-4 grid grid-cols-3 gap-3 text-sm">
                        <div>
                          <div className="flex justify-between"><span>Lag</span><span>{p.lag}%</span></div>
                          <ProgressBar value={p.lag} />
                        </div>
                        <div>
                          <div className="flex justify-between"><span>Lead</span><span>{p.lead}%</span></div>
                          <ProgressBar value={p.lead} />
                        </div>
                        <div>
                          <div className="flex justify-between"><span>Lift</span><span>{p.lift}%</span></div>
                          <ProgressBar value={p.lift} />
                        </div>
                      </div>
                      <div className="mt-3 text-sm">Overall: <strong>{overall}%</strong> · Dials: <strong>{p.dials ?? 0}</strong></div>

                      <div className="mt-4">
                        <p className="text-sm font-medium">Recent Actions</p>
                        <ul className="list-disc pl-5 text-sm text-gray-700 mt-1 space-y-1">
                          {(p.notes && p.notes.length ? p.notes : ["No actions yet."]).map((n, i) => <li key={i}>{n}</li>)}
                        </ul>
                      </div>
                    </div>
                  );
                })()}
              </div>
            </div>
          )}

          {/* Footer */}
          <footer className="mb-8">
            <div className="rounded-2xl border p-4 flex flex-wrap items-center gap-3 justify-between">
              <div className="text-sm text-gray-600">Prototype · Staging Hub · All demos in one link · Simple & motivating</div>
              <div className="flex items-center gap-2">
                <a href="#demo-aaa" className="px-3 py-1 rounded-full border text-sm hover:bg-gray-50">Go to AAA</a>
                <a href="#demo-vmap" className="px-3 py-1 rounded-full border text-sm hover:bg-gray-50">Edit V-MAP</a>
              </div>
            </div>
          </footer>
        </div>
      );
    }

    // Mount
    ReactDOM.createRoot(document.getElementById("root")).render(<PacxStagingHub />);
  </script>
</body>
</html>
